# Tox (http://tox.testrun.org/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

[tox]
envlist = pre-commit,min,min-hbase,min-kafka,min-logging,min-s3,min-scrapy,min-sql,min-zeromq,min-all,py39,py310,py311,py312,py313,hbase,kafka,logging,s3,scrapy,sql,zeromq,all
minversion = 1.8

[testenv]
deps =
    flaky
    pytest
    pytest-cov
commands =
    pytest --cov-report=term --cov=frontera -s -v {posargs:tests}

[testenv:hbase]
extras = hbase

[testenv:kafka]
extras = kafka
# https://github.com/dpkp/kafka-python/issues/2412
basepython = python3.11

[testenv:logging]
extras = logging

[testenv:s3]
extras = s3

[testenv:scrapy]
extras = scrapy

[testenv:sql]
extras = sql

[testenv:zeromq]
extras = zeromq

[testenv:all]
extras =
    hbase
    kafka
    logging
    s3
    scrapy
    sql
    zeromq

[testenv:min]
basepython = python3.9
deps =
    {[testenv]deps}
    cityhash==0.4.7
    six==1.8.0
    w3lib==1.17.0

[testenv:min-hbase]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    cachetools==0.4.0
    happybase==1.2.0
    msgpack-python==0.4
    setuptools==50.3.1

[testenv:min-kafka]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    kafka-python==1.4.3
    twisted==20.3.0

[testenv:min-logging]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    colorlog==2.4.0
    python-json-logger==0.1.5

[testenv:min-s3]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    boto==2.49.0

[testenv:min-scrapy]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    scrapy==2.7.0

[testenv:min-sql]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    cachetools==0.4.0
    SQLAlchemy==1.0.0

[testenv:min-zeromq]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    pyzmq==19.0.2
    msgpack-python==0.4

[testenv:min-all]
basepython = {[testenv:min]basepython}
deps =
    {[testenv:min]deps}
    {[testenv:min-hbase]deps}
    {[testenv:min-kafka]deps}
    {[testenv:min-logging]deps}
    {[testenv:min-s3]deps}
    {[testenv:min-scrapy]deps}
    {[testenv:min-sql]deps}
    {[testenv:min-zeromq]deps}

[testenv:pre-commit]
deps = pre-commit
commands = pre-commit run --all

# Options for pytest
[pytest]
addopts = -rsvXf
testpaths = tests
ignore=requirements
